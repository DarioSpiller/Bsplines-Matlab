<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T17U3">N_0</span>,<span class="var type1" id="S3T16U4">N_1</span>,<span class="var type1" id="S4T18U5">N_2</span>] = triangular_algorithm_TBM(<span class="var type1" id="S5T3U8">n</span>,<span class="var type1" id="S6T3U9">p</span>,<span class="var type1" id="S7T1U10">u</span>,<span class="var type1" id="S8T3U11">m</span>,<span class="var type1" id="S9T2U12">knot_points</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Input: n, p, m, u, and m+1 clamped knots { u0, <span class="keyword">...</span><span class="comment">, um }</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Output: Coefficients N0,p(u), N1,p(u), <span class="keyword">...</span><span class="comment">, Nn,p(u) in N[0], N[1], ..., N[n]</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% TO-BE-MEXED VERSION!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% Algorithm</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%% degree 0 coefficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% rule out special cases</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T4:U9"><span class="var type1" id="S7T1U16">u</span> == <span class="mxinfo" id="T1:U11"><span class="var type1" id="S9T2U18">knot_points</span>(<span class="mxinfo" id="T1:U13">1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">    <span class="comment">% u corrisponde al primo knot point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="mxinfo" id="T3:U14"><span class="var type1" id="S10T3U22">k</span> = <span class="mxinfo" id="T3:U16">int8(<span class="mxinfo" id="T1:U17">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo" id="T4:U18"><span class="var type1" id="S7T1U28">u</span> == <span class="mxinfo" id="T1:U20"><span class="var type1" id="S9T2U30">knot_points</span>(<span class="mxinfo" id="T3:U22"><span class="var type1" id="S8T3U32">m</span>+<span class="mxinfo" id="T3:U24">1</span></span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">    <span class="comment">% u corrisponde all'ultimo knot point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">    <span class="mxinfo" id="T3:U25"><span class="var type1" id="S10T3U36">k</span> = <span class="mxinfo" id="T3:U27"><span class="mxinfo" id="T3:U28"><span class="var type1" id="S5T3U39">n</span>+<span class="var type1" id="S6T3U40">p</span></span>-<span class="mxinfo" id="T3:U31">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">    <span class="comment">% now u is between the first and the last knot point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">    <span class="comment">% Let u be in knot span [uk,uk+1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">    <span class="comment">% Original MATLAB code</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">    <span class="comment">% k = int8(sum(u &gt; knot_points));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">    <span class="comment">% C-like code</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">    <span class="mxinfo" id="T3:U32"><span class="var type1" id="S10T3U45">k</span> = <span class="mxinfo" id="T3:U34">int8(<span class="mxinfo" id="T1:U35">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo" id="T4:U36"><span class="var type1" id="S7T1U51">u</span>&gt;<span class="mxinfo" id="T1:U38"><span class="var type1" id="S9T2U53">knot_points</span>(<span class="mxinfo" id="T3:U40"><span class="var type1" id="S10T3U55">k</span>+<span class="mxinfo" id="T3:U42">1</span></span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">        <span class="mxinfo" id="T3:U43"><span class="var type1" id="S10T3U59">k</span> = <span class="mxinfo" id="T3:U45"><span class="var type1" id="S10T3U61">k</span> + <span class="mxinfo" id="T3:U47">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T3:U48"><span class="var type1" id="S12T3U65">max_length</span> = <span class="mxinfo" id="T3:U50"><span class="mxinfo" id="T3:U51"><span class="var type1" id="S5T3U68">n</span>+<span class="var type1" id="S6T3U69">p</span></span>-<span class="mxinfo" id="T3:U54">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T14:U55"><span class="var type1" id="S13T14U73">L_N_1</span> = <span class="mxinfo" id="T14:U57">2:<span class="var type1" id="S5T3U76">n</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T15:U59"><span class="var type1" id="S14T15U79">L_N_2</span> = <span class="mxinfo" id="T15:U61">3:<span class="var type1" id="S5T3U82">n</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo" id="T16:U63"><span class="var type1" id="S15T16U85">N</span> = <span class="mxinfo" id="T16:U65">zeros(<span class="mxinfo" id="T1:U66">1</span>,<span class="var type1" id="S12T3U89">max_length</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo" id="T17:U68"><span class="var type1" id="S2T17U92">N_0</span> = <span class="mxinfo" id="T17:U70">zeros(<span class="mxinfo" id="T1:U71">1</span>,<span class="var type1" id="S5T3U96">n</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo" id="T16:U73"><span class="var type1" id="S3T16U99">N_1</span> = <span class="mxinfo" id="T16:U75"><span class="var type1" id="S2T17U101">N_0</span>(<span class="var type1" id="S13T14U102">L_N_1</span>)</span></span>;   <span class="comment">% derivata prima</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T18:U78"><span class="var type1" id="S4T18U105">N_2</span> = <span class="mxinfo" id="T18:U80"><span class="var type1" id="S2T17U107">N_0</span>(<span class="var type1" id="S14T15U108">L_N_2</span>)</span></span>;   <span class="comment">% derivata seconda</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T1:U83"><span class="var type1" id="S17T1U111">num</span> = <span class="mxinfo" id="T1:U85">0</span></span>;            <span class="comment">%#ok, for mexing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo" id="T1:U86"><span class="var type1" id="S18T1U115">den</span> = <span class="mxinfo" id="T1:U88">0</span></span>;            <span class="comment">%#ok, for mexing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo" id="T1:U89"><span class="var type1" id="S19T1U119">coeff</span> = <span class="mxinfo" id="T1:U91">0</span></span>;          <span class="comment">%#ok, for mexing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T1:U92"><span class="var type1" id="S20T1U123">coeff1</span> = <span class="mxinfo" id="T1:U94">0</span></span>;         <span class="comment">%#ok, for mexing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo" id="T1:U95"><span class="var type1" id="S21T1U127">coeff2</span> = <span class="mxinfo" id="T1:U97">0</span></span>;         <span class="comment">%#ok, for mexing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo" id="T1:U98"><span class="mxinfo" id="T1:U99"><span class="var type1" id="S15T16U132">N</span>(<span class="var type1" id="S10T3U133">k</span>)</span> = <span class="mxinfo" id="T1:U102">1.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%% degree d goes from 1 to p</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% globally used quantities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T1:U103"><span class="var type1" id="S22T1U137">KP_k</span> = <span class="mxinfo" id="T1:U105"><span class="var type1" id="S9T2U139">knot_points</span>(<span class="var type1" id="S10T3U140">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T1:U108"><span class="var type1" id="S23T1U143">KP_kplus1</span> = <span class="mxinfo" id="T1:U110"><span class="var type1" id="S9T2U145">knot_points</span>(<span class="mxinfo" id="T3:U112"><span class="var type1" id="S10T3U147">k</span>+<span class="mxinfo" id="T3:U114">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo" id="T1:U115"><span class="var type1" id="S24T1U151">num1</span> = (<span class="mxinfo" id="T1:U117"><span class="var type1" id="S23T1U154">KP_kplus1</span> - <span class="var type1" id="S7T1U155">u</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T1:U120"><span class="var type1" id="S25T1U158">num2</span> = (<span class="mxinfo" id="T1:U122"><span class="var type1" id="S7T1U161">u</span> - <span class="var type1" id="S22T1U162">KP_k</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo" id="T4:U125"><span class="var type1" id="S26T4U165">zero_num1</span> = <span class="mxinfo" id="T4:U127"><span class="var type1" id="S24T1U167">num1</span> == <span class="mxinfo" id="T1:U129">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T4:U130"><span class="var type1" id="S27T4U171">zero_num2</span> = <span class="mxinfo" id="T4:U132"><span class="var type1" id="S25T1U173">num2</span> == <span class="mxinfo" id="T1:U134">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S28T3U177">d</span> = <span class="mxinfo" id="T3:U136">1</span>:<span class="mxinfo" id="T3:U137"><span class="var type1" id="S6T3U181">p</span>-<span class="mxinfo" id="T3:U139">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T4:U140"><span class="mxinfo" id="T3:U141"><span class="var type1" id="S10T3U187">k</span> - <span class="var type1" id="S28T3U188">d</span></span> &gt; <span class="mxinfo" id="T1:U144">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">        <span class="comment">% right (south-west corner) term only</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">        <span class="mxinfo" id="T1:U145"><span class="var type1" id="S18T1U192">den</span> = (<span class="mxinfo" id="T1:U147"><span class="var type1" id="S23T1U195">KP_kplus1</span> - <span class="mxinfo" id="T1:U149"><span class="var type1" id="S9T2U197">knot_points</span>(<span class="mxinfo" id="T3:U151"><span class="mxinfo" id="T3:U152"><span class="var type1" id="S10T3U200">k</span>-<span class="var type1" id="S28T3U201">d</span></span>+<span class="mxinfo" id="T3:U155">1</span></span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T1:U156"><span class="var type1" id="S19T1U205">coeff</span> = <span class="mxinfo" id="T1:U158"><span class="var type1" id="S24T1U207">num1</span>/<span class="var type1" id="S18T1U208">den</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">        <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">        <span class="keyword">if</span> <span class="var type1" id="S26T4U212">zero_num1</span> &amp;&amp; <span class="mxinfo" id="T4:U162"><span class="var type1" id="S18T1U214">den</span> == <span class="mxinfo" id="T1:U164">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">            <span class="mxinfo" id="T1:U165"><span class="var type1" id="S19T1U218">coeff</span> = <span class="mxinfo" id="T1:U167">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">        <span class="mxinfo" id="T1:U168"><span class="mxinfo" id="T1:U169"><span class="var type1" id="S15T16U223">N</span>(<span class="mxinfo" id="T3:U171"><span class="var type1" id="S10T3U225">k</span>-<span class="var type1" id="S28T3U226">d</span></span>)</span> = <span class="mxinfo" id="T1:U174"><span class="var type1" id="S19T1U228">coeff</span> * <span class="mxinfo" id="T1:U176"><span class="var type1" id="S15T16U230">N</span>(<span class="mxinfo" id="T3:U178">(<span class="mxinfo" id="T3:U179"><span class="var type1" id="S10T3U234">k</span>-<span class="var type1" id="S28T3U235">d</span></span>)+<span class="mxinfo" id="T3:U182">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    <span class="keyword">if</span>  <span class="mxinfo" id="T4:U183"><span class="var type1" id="S28T3U242">d</span> &gt;= <span class="mxinfo" id="T1:U185">2</span></span> &amp;&amp; <span class="mxinfo" id="T4:U186"><span class="var type1" id="S10T3U245">k</span>&gt;=<span class="mxinfo" id="T1:U188">2</span></span>  &amp;&amp; <span class="mxinfo" id="T4:U189"><span class="var type1" id="S10T3U248">k</span> &lt; <span class="mxinfo" id="T3:U191"><span class="mxinfo" id="T3:U192"><span class="var type1" id="S5T3U251">n</span> + <span class="var type1" id="S6T3U252">p</span></span> - <span class="mxinfo" id="T3:U195">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">        <span class="comment">% compute internal terms</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S29T3U256">i</span> = <span class="mxinfo" id="T3:U197"><span class="mxinfo" id="T3:U198"><span class="var type1" id="S10T3U260">k</span>-<span class="var type1" id="S28T3U261">d</span></span>+<span class="mxinfo" id="T3:U201">1</span></span>:<span class="mxinfo" id="T3:U202"><span class="var type1" id="S10T3U264">k</span>-<span class="mxinfo" id="T3:U204">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T4:U205"><span class="var type1" id="S29T3U270">i</span> &gt; <span class="mxinfo" id="T1:U207">0</span></span> &amp;&amp; <span class="mxinfo" id="T4:U208"><span class="mxinfo" id="T3:U209"><span class="var type1" id="S29T3U274">i</span> + <span class="var type1" id="S28T3U275">d</span></span> &lt; <span class="mxinfo" id="T3:U212"><span class="var type1" id="S8T3U277">m</span> + <span class="mxinfo" id="T3:U214">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">                <span class="mxinfo" id="T1:U215"><span class="var type1" id="S20T1U281">coeff1</span> = <span class="mxinfo" id="T1:U217">(<span class="mxinfo" id="T1:U218"><span class="var type1" id="S7T1U285">u</span> - <span class="mxinfo" id="T1:U220"><span class="var type1" id="S9T2U287">knot_points</span>(<span class="var type1" id="S29T3U288">i</span>)</span></span>)/(<span class="mxinfo" id="T1:U223"><span class="mxinfo" id="T1:U224"><span class="var type1" id="S9T2U292">knot_points</span>(<span class="mxinfo" id="T3:U226"><span class="var type1" id="S29T3U294">i</span>+<span class="var type1" id="S28T3U295">d</span></span>)</span> - <span class="mxinfo" id="T1:U229"><span class="var type1" id="S9T2U297">knot_points</span>(<span class="var type1" id="S29T3U298">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">                <span class="mxinfo" id="T1:U232"><span class="var type1" id="S21T1U301">coeff2</span> = <span class="mxinfo" id="T1:U234">(<span class="mxinfo" id="T1:U235"><span class="mxinfo" id="T1:U236"><span class="var type1" id="S9T2U306">knot_points</span>(<span class="mxinfo" id="T3:U238"><span class="mxinfo" id="T3:U239"><span class="var type1" id="S29T3U309">i</span>+<span class="var type1" id="S28T3U310">d</span></span>+<span class="mxinfo" id="T3:U242">1</span></span>)</span> - <span class="var type1" id="S7T1U312">u</span></span>)/(<span class="mxinfo" id="T1:U244"><span class="mxinfo" id="T1:U245"><span class="var type1" id="S9T2U316">knot_points</span>(<span class="mxinfo" id="T3:U247"><span class="mxinfo" id="T3:U248"><span class="var type1" id="S29T3U319">i</span>+<span class="var type1" id="S28T3U320">d</span></span>+<span class="mxinfo" id="T3:U251">1</span></span>)</span> - <span class="mxinfo" id="T1:U252"><span class="var type1" id="S9T2U323">knot_points</span>(<span class="mxinfo" id="T3:U254"><span class="var type1" id="S29T3U325">i</span>+<span class="mxinfo" id="T3:U256">1</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">                <span class="mxinfo" id="T1:U257"><span class="mxinfo" id="T1:U258"><span class="var type1" id="S15T16U330">N</span>(<span class="var type1" id="S29T3U331">i</span>)</span> = <span class="mxinfo" id="T1:U261"><span class="mxinfo" id="T1:U262"><span class="var type1" id="S20T1U334">coeff1</span> * <span class="mxinfo" id="T1:U264"><span class="var type1" id="S15T16U336">N</span>(<span class="var type1" id="S29T3U337">i</span>)</span></span> + <span class="mxinfo" id="T1:U267"><span class="var type1" id="S21T1U339">coeff2</span> * <span class="mxinfo" id="T1:U269"><span class="var type1" id="S15T16U341">N</span>(<span class="mxinfo" id="T3:U271"><span class="var type1" id="S29T3U343">i</span>+<span class="mxinfo" id="T3:U273">1</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T4:U274"><span class="var type1" id="S10T3U348">k</span> &lt;= <span class="mxinfo" id="T3:U276"><span class="mxinfo" id="T3:U277"><span class="var type1" id="S5T3U351">n</span> + (<span class="mxinfo" id="T3:U279"><span class="var type1" id="S6T3U354">p</span>-<span class="mxinfo" id="T3:U281">1</span></span>)</span> - <span class="var type1" id="S28T3U356">d</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="comment">% let (north-west corner) term only</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">        <span class="mxinfo" id="T1:U283"><span class="var type1" id="S18T1U359">den</span> = (<span class="mxinfo" id="T1:U285"><span class="mxinfo" id="T1:U286"><span class="var type1" id="S9T2U363">knot_points</span>(<span class="mxinfo" id="T3:U288"><span class="var type1" id="S10T3U365">k</span>+<span class="var type1" id="S28T3U366">d</span></span>)</span> - <span class="var type1" id="S22T1U367">KP_k</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo" id="T1:U292"><span class="var type1" id="S19T1U370">coeff</span> = <span class="mxinfo" id="T1:U294"><span class="var type1" id="S25T1U372">num2</span>/<span class="var type1" id="S18T1U373">den</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        <span class="keyword">if</span> <span class="var type1" id="S27T4U377">zero_num2</span> &amp;&amp; <span class="mxinfo" id="T4:U298"><span class="var type1" id="S18T1U379">den</span> == <span class="mxinfo" id="T1:U300">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">            <span class="mxinfo" id="T1:U301"><span class="var type1" id="S19T1U383">coeff</span> = <span class="mxinfo" id="T1:U303">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">        <span class="mxinfo" id="T1:U304"><span class="mxinfo" id="T1:U305"><span class="var type1" id="S15T16U388">N</span>(<span class="var type1" id="S10T3U389">k</span>)</span> = <span class="mxinfo" id="T1:U308"><span class="var type1" id="S19T1U391">coeff</span> * <span class="mxinfo" id="T1:U310"><span class="var type1" id="S15T16U393">N</span>(<span class="var type1" id="S10T3U394">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T4:U313"><span class="var type1" id="S28T3U398">d</span> == <span class="mxinfo" id="T3:U315"><span class="var type1" id="S6T3U400">p</span>-<span class="mxinfo" id="T3:U317">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">        <span class="comment">% First derivative</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T4:U318"><span class="mxinfo" id="T1:U319"><span class="var type1" id="S15T16U407">N</span>(<span class="mxinfo" id="T1:U321">1</span>)</span> ~= <span class="mxinfo" id="T1:U322">1</span></span> &amp;&amp; <span class="mxinfo" id="T4:U323"><span class="mxinfo" id="T1:U324"><span class="var type1" id="S15T16U412">N</span>(<span class="mxinfo" id="T1:U326">end</span>)</span> ~= <span class="mxinfo" id="T1:U327">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">            <span class="comment">% Common case</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">            <span class="mxinfo" id="T16:U328"><span class="var type1" id="S3T16U418">N_1</span> = <span class="mxinfo" id="T16:U330"><span class="var type1" id="S15T16U420">N</span>(<span class="var type1" id="S13T14U421">L_N_1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo" id="T4:U333"><span class="mxinfo" id="T1:U334"><span class="var type1" id="S15T16U425">N</span>(<span class="mxinfo" id="T1:U336">1</span>)</span> == <span class="mxinfo" id="T1:U337">1</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">            <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">            <span class="mxinfo" id="T16:U338"><span class="var type1" id="S3T16U430">N_1</span> = <span class="mxinfo" id="T16:U340"><span class="var type1" id="S15T16U432">N</span>(<span class="mxinfo" id="T14:U342"><span class="var type1" id="S13T14U434">L_N_1</span> - <span class="mxinfo" id="T3:U344">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo" id="T4:U345"><span class="mxinfo" id="T1:U346"><span class="var type1" id="S15T16U439">N</span>(<span class="mxinfo" id="T1:U348">end</span>)</span> == <span class="mxinfo" id="T1:U349">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">            <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">            <span class="mxinfo" id="T1:U350"><span class="mxinfo" id="T1:U351"><span class="var type1" id="S3T16U446">N_1</span>(<span class="mxinfo" id="T1:U353">end</span>)</span> = <span class="mxinfo" id="T1:U354">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo" id="T4:U355"><span class="var type1" id="S28T3U452">d</span> == <span class="mxinfo" id="T3:U357"><span class="var type1" id="S6T3U454">p</span>-<span class="mxinfo" id="T3:U359">3</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        <span class="comment">% Second derivative</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T4:U360"><span class="mxinfo" id="T1:U361"><span class="var type1" id="S15T16U461">N</span>(<span class="mxinfo" id="T1:U363">1</span>)</span> ~= <span class="mxinfo" id="T1:U364">1</span></span> &amp;&amp; <span class="mxinfo" id="T4:U365"><span class="mxinfo" id="T1:U366"><span class="var type1" id="S15T16U466">N</span>(<span class="mxinfo" id="T1:U368">end</span>)</span> ~= <span class="mxinfo" id="T1:U369">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">            <span class="comment">% Common case</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">            <span class="mxinfo" id="T18:U370"><span class="var type1" id="S4T18U472">N_2</span> = <span class="mxinfo" id="T18:U372"><span class="var type1" id="S15T16U474">N</span>(<span class="var type1" id="S14T15U475">L_N_2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo" id="T4:U375"><span class="mxinfo" id="T1:U376"><span class="var type1" id="S15T16U479">N</span>(<span class="mxinfo" id="T1:U378">1</span>)</span> == <span class="mxinfo" id="T1:U379">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">            <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">            <span class="mxinfo" id="T18:U380"><span class="var type1" id="S4T18U484">N_2</span> = <span class="mxinfo" id="T18:U382"><span class="var type1" id="S15T16U486">N</span>(<span class="mxinfo" id="T15:U384"><span class="var type1" id="S14T15U488">L_N_2</span> - <span class="mxinfo" id="T3:U386">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo" id="T4:U387"><span class="mxinfo" id="T1:U388"><span class="var type1" id="S15T16U493">N</span>(<span class="mxinfo" id="T1:U390">end</span>)</span> == <span class="mxinfo" id="T1:U391">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">            <span class="comment">% to deal with singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">            <span class="mxinfo" id="T1:U392"><span class="mxinfo" id="T1:U393"><span class="var type1" id="S4T18U500">N_2</span>(<span class="mxinfo" id="T1:U395">end</span>)</span> = <span class="mxinfo" id="T1:U396">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="comment">% array N[0..n] has the coefficients.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo" id="T17:U397"><span class="var type1" id="S2T17U506">N_0</span> = <span class="mxinfo" id="T16:U399"><span class="var type1" id="S15T16U508">N</span>(<span class="mxinfo" id="T3:U401">1</span>:<span class="var type1" id="S5T3U511">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
